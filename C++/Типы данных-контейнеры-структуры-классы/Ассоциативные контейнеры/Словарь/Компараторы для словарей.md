Сортировка ключей в словаре происходит с помощью операций сравнения, которые определяют порядок элементов. Для встроенных типов используется стандартное сравнение — именно поэтому числовые или строковые ключи сортируются по возрастанию.

Контейнер `std::map` позволяет задавать собственные правила для упорядочивания элементов. Благодаря этому можно не только иначе сортировать стандартные типы, но и использовать в качестве ключей более сложные объекты.

Правила сортировки задаются через компаратор — функцию, которая принимает два параметра и возвращает логический результат их сравнения. В `std::map` компаратор указывается в момент создания словаря и не может быть изменён в процессе работы.

Существует несколько способов задать компаратор. Его можно объявить в виде функционального объекта (структуры или класса) и передавать как шаблонный аргумент.

Создадим компаратор, сортирующий ключи в обратном порядке.

```cpp
// Компаратор для сортировки строк по убыванию.
struct Comparator{
    bool operator()(std::string a, std::string b) const {
        return a > b;
    }
};

// Передаём Comparator в виде шаблонного аргумента.
std::map<std::string, int, Comparator> prices = {
    {"Milk"s, 99},
    {"Sugar"s, 110},
    {"Donut"s, 150},
};

// Теперь ключи хранятся в обратном порядке.   
// Sugar: 110
// Milk: 99
// Donut: 150 
```

Чтобы сократить запись, можно объявить компаратор в виде лямбда-функции.

```cpp
auto comparator = [](std::string a, std::string b) {
    return a > b;
};

std::map<std::string, int, decltype(comparator)> prices = {
    {"Milk"s, 99},
    {"Sugar"s, 110},
    {"Donut"s, 150},
}; 
```

В этом случае он также указывается среди шаблонных аргументов. Поскольку используется анонимная лямбда-функция, для определения типа необходимо использовать `decltype`.

Этого можно избежать, если явно прописать тип лямбда-функции.

```cpp
std::function<bool(std::string, std::string)> 
comparator = [](std::string a, std::string b) {
    return a > b;  
};

std::map<std::string, 
         std::string, 
         std::function<bool(std::string, std::string)>
         > prices(comparator); 
```